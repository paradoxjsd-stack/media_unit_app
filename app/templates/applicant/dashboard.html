{% extends "base.html" %}

{% block title %}My Dashboard - Media Unit{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex justify-between items-start mb-8">
        <div>
            <h1 class="text-4xl font-bold text-gray-900 mb-2">Welcome, {{ applicant.full_name }}! üëã</h1>
            <p class="text-gray-600">Here's your personal media unit dashboard</p>
        </div>
        <a href="{{ url_for('auth.applicant_logout') }}" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 font-bold">
            Logout
        </a>
    </div>

    <!-- Profile Card -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="md:col-span-1 bg-white rounded-lg shadow-lg p-6">
            <div class="text-center">
                {% if applicant.profile_picture %}
                <img src="{{ url_for('media.download_file', file_path=applicant.profile_picture) }}" alt="Profile" class="w-24 h-24 rounded-full mx-auto mb-4 object-cover">
                {% else %}
                <div class="w-24 h-24 rounded-full mx-auto mb-4 bg-red-100 flex items-center justify-center text-4xl">
                    üë§
                </div>
                {% endif %}
                
                <h2 class="text-2xl font-bold text-gray-900 mb-1">{{ applicant.full_name }}</h2>
                <p class="text-gray-600 text-sm mb-4">{{ applicant.email }}</p>
                
                <div class="space-y-2 text-left text-sm">
                    {% if applicant.date_of_birth %}
                    <div><strong>DOB:</strong> {{ applicant.date_of_birth.strftime('%B %d, %Y') }}</div>
                    {% endif %}
                    {% if applicant.occupation %}
                    <div><strong>Occupation:</strong> {{ applicant.occupation }}</div>
                    {% endif %}
                    <div><strong>Phone:</strong> {{ applicant.phone or 'N/A' }}</div>
                    <div><strong>Interest:</strong> {{ applicant.primary_interest }}</div>
                </div>
                
                <a href="{{ url_for('applicant.update_profile') }}" class="block mt-4 w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 font-semibold">
                    Edit Profile
                </a>
            </div>
        </div>

        <!-- Status & Stats -->
        <div class="md:col-span-2 space-y-6">
            <!-- Application Status -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-900 mb-4">üìã Application Status</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                        <span class="text-gray-700 font-medium">Status</span>
                        <span class="px-4 py-1 rounded-full text-sm font-semibold
                            {% if applicant.status == 'pending' %}
                            bg-yellow-100 text-yellow-800
                            {% elif applicant.status == 'approved' %}
                            bg-green-100 text-green-800
                            {% elif applicant.status == 'completed' %}
                            bg-blue-100 text-blue-800
                            {% else %}
                            bg-red-100 text-red-800
                            {% endif %}
                        ">
                            {{ applicant.status|capitalize }}
                        </span>
                    </div>

                    {% if applicant.assigned_subunit %}
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                        <span class="text-gray-700 font-medium">Assigned Subunit</span>
                        <span class="text-gray-900 font-semibold">{{ applicant.subunit.name }}</span>
                    </div>
                    {% endif %}

                    {% if applicant.assigned_mentor %}
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                        <span class="text-gray-700 font-medium">Mentor</span>
                        <span class="text-gray-900 font-semibold">{{ applicant.assigned_mentor.username }}</span>
                    </div>
                    {% endif %}

                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                        <span class="text-gray-700 font-medium">Applied On</span>
                        <span class="text-gray-900 font-semibold">{{ applicant.created_at.strftime('%B %d, %Y') }}</span>
                    </div>
                </div>
            </div>

            <!-- Skills Summary -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-900 mb-4">üéØ Your Skills</h3>
                {% if applicant.skills %}
                <div class="space-y-2">
                    {% for skill in applicant.skills[:5] %}
                    <div class="flex items-center justify-between">
                        <span class="text-gray-700">{{ skill.skill_name }}</span>
                        <div class="flex space-x-1">
                            {% for i in range(1, 6) %}
                            <div class="w-2 h-6 {% if i <= skill.rating %}bg-red-600{% else %}bg-gray-300{% endif %}"></div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <a href="{{ url_for('applicant.update_profile') }}" class="text-red-600 hover:text-red-800 font-semibold text-sm mt-3 inline-block">
                    Update Skills ‚Üí
                </a>
                {% else %}
                <p class="text-gray-600">No skills assessed yet</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Suggested Features -->
    <div class="mb-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">üí° What's Next?</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            {% for feature in suggested_features %}
            <a href="{{ feature.link }}" class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition block group">
                <div class="text-4xl mb-3 group-hover:scale-110 transition">{{ feature.icon }}</div>
                <h3 class="text-lg font-bold text-gray-900 mb-2 group-hover:text-red-600 transition">{{ feature.title }}</h3>
                <p class="text-gray-600 text-sm">{{ feature.description }}</p>
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Trial Phases Progress -->
    {% if applicant.trial_phases %}
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <h3 class="text-2xl font-bold text-gray-900 mb-6">üìä Selection Process Progress</h3>
        <div class="space-y-4">
            {% for phase in applicant.trial_phases %}
            <div class="flex items-center space-x-4">
                <div class="flex-1">
                    <div class="font-semibold text-gray-900">
                        {{ phase.phase_type.replace('_', ' ').title() }}
                    </div>
                    <div class="text-sm text-gray-600">
                        {% if phase.status == 'completed' %}
                        ‚úì Completed {{ phase.completed_date.strftime('%B %d') if phase.completed_date else '' }}
                        {% elif phase.status == 'pass' %}
                        ‚úì Passed with score: {{ phase.score }}
                        {% elif phase.status == 'fail' %}
                        ‚úó Not passed - Please contact your mentor
                        {% else %}
                        ‚è≥ Pending
                        {% endif %}
                    </div>
                </div>
                <div class="px-3 py-1 rounded-full text-xs font-semibold
                    {% if phase.status == 'completed' or phase.status == 'pass' %}
                    bg-green-100 text-green-800
                    {% elif phase.status == 'fail' %}
                    bg-red-100 text-red-800
                    {% else %}
                    bg-yellow-100 text-yellow-800
                    {% endif %}
                ">
                    {{ phase.status|capitalize }}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Account Info -->
    <div class="bg-gray-50 rounded-lg p-6 text-center text-sm text-gray-600">
        <p>Last login: 
            {% if applicant.account and applicant.account.last_login %}
            {{ applicant.account.last_login.strftime('%B %d, %Y at %I:%M %p') }}
            {% else %}
            This is your first login
            {% endif %}
        </p>
    </div>
</div>
{% endblock %}
