{% extends "base.html" %}

{% block title %}Media Library - Media Unit Management{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex justify-between items-center">
        <h2 class="text-3xl font-bold text-gray-800">Media Library</h2>
        {% if session.get('user_id') %}
        <a href="{{ url_for('media.upload_media') }}" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">+ Upload Media</a>
        {% endif %}
    </div>
</div>

<!-- Filters -->
<div class="bg-white rounded-lg shadow p-6 mb-8">
    <form method="get" class="flex flex-wrap gap-4 items-end">
        <div>
            <label class="block text-gray-700 font-bold mb-2">Media Type</label>
            <select name="type" onchange="this.form.submit()" class="px-4 py-2 border border-gray-300 rounded-lg">
                <option value="">All Types</option>
                <option value="photo" {% if selected_type == 'photo' %}selected{% endif %}>Photos</option>
                <option value="audio" {% if selected_type == 'audio' %}selected{% endif %}>Audio</option>
                <option value="graphics" {% if selected_type == 'graphics' %}selected{% endif %}>Graphics</option>
                <option value="video" {% if selected_type == 'video' %}selected{% endif %}>Video</option>
            </select>
        </div>
        
        <div>
            <label class="block text-gray-700 font-bold mb-2">Subunit</label>
            <select name="subunit" onchange="this.form.submit()" class="px-4 py-2 border border-gray-300 rounded-lg">
                <option value="">All Subunits</option>
                {% for subunit in subunits %}
                <option value="{{ subunit.id }}" {% if selected_subunit == subunit.id %}selected{% endif %}>{{ subunit.name }}</option>
                {% endfor %}
            </select>
        </div>
    </form>
</div>

<!-- Media Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    {% for item in media_items.items %}
    <div class="bg-white rounded-lg shadow hover:shadow-lg transition overflow-hidden">
        <!-- Thumbnail -->
        <div class="bg-gray-200 h-48 flex items-center justify-center text-gray-400">
            {% if item.media_type == 'photo' %}
            ğŸ“·
            {% elif item.media_type == 'audio' %}
            ğŸ™ï¸
            {% elif item.media_type == 'graphics' %}
            ğŸ¨
            {% elif item.media_type == 'video' %}
            ğŸ¬
            {% else %}
            ğŸ“
            {% endif %}
        </div>
        
        <!-- Info -->
        <div class="p-4">
            <h3 class="font-bold text-gray-800 mb-2 truncate">{{ item.title }}</h3>
            
            {% if item.event_name %}
            <p class="text-sm text-gray-600 mb-2">ğŸ“… {{ item.event_name }}</p>
            {% endif %}
            
            {% if item.subunit %}
            <p class="text-sm text-gray-600 mb-2">ğŸ·ï¸ {{ item.subunit.name }}</p>
            {% endif %}
            
            <p class="text-xs text-gray-500 mb-4">{{ item.uploaded_at.strftime('%b %d, %Y') }}</p>
            
            <!-- Actions -->
            <div class="flex gap-2">
                <a href="{{ url_for('media.download_media', media_id=item.id) }}" class="flex-1 bg-blue-600 text-white px-3 py-2 rounded text-center text-sm hover:bg-blue-700">
                    Download
                </a>
                {% if session.get('user_id') %}
                <button onclick="deleteMedia({{ item.id }})" class="flex-1 bg-red-600 text-white px-3 py-2 rounded text-sm hover:bg-red-700">
                    Delete
                </button>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Empty State -->
{% if not media_items.items %}
<div class="bg-gray-100 rounded-lg p-12 text-center">
    <div class="text-4xl mb-4">ğŸ“</div>
    <h3 class="text-xl font-bold text-gray-800 mb-2">No Media Found</h3>
    <p class="text-gray-600">No media items match your filters. Check back later!</p>
</div>
{% endif %}

<!-- Pagination -->
{% if media_items.pages > 1 %}
<div class="flex justify-center mt-8 space-x-2">
    {% if media_items.has_prev %}
    <a href="{{ url_for('media.library', page=media_items.prev_num, type=selected_type, subunit=selected_subunit) }}" class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">Previous</a>
    {% endif %}
    
    <span class="px-4 py-2">Page {{ media_items.page }} of {{ media_items.pages }}</span>
    
    {% if media_items.has_next %}
    <a href="{{ url_for('media.library', page=media_items.next_num, type=selected_type, subunit=selected_subunit) }}" class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">Next</a>
    {% endif %}
</div>
{% endif %}

<script>
function deleteMedia(mediaId) {
    if (confirm('Are you sure you want to delete this media?')) {
        fetch(`/media/${mediaId}/delete`, {
            method: 'POST'
        })
        .then(r => r.json())
        .then(d => {
            if (d.success) {
                location.reload();
            } else {
                alert('Error: ' + d.error);
            }
        });
    }
}
</script>
{% endblock %}
