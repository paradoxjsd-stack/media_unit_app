{% extends "base.html" %}

{% block title %}Manage Admins - Media Unit Management{% endblock %}

{% block content %}
<div class="mb-8">
    <h2 class="text-3xl font-bold text-gray-800 mb-4">Manage Admin Users</h2>
    <button onclick="showCreateForm()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">+ Create Admin</button>
</div>

<!-- Create Admin Form -->
<div id="createFormContainer" class="hidden bg-white rounded-lg shadow p-6 mb-8">
    <h3 class="text-xl font-bold text-gray-800 mb-4">Create New Admin</h3>
    <form id="createAdminForm" class="space-y-4">
        <div>
            <label class="block text-gray-700 font-bold mb-2">Username</label>
            <input type="text" name="username" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-red-500">
        </div>
        <div>
            <label class="block text-gray-700 font-bold mb-2">Email</label>
            <input type="email" name="email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-red-500">
        </div>
        <div>
            <label class="block text-gray-700 font-bold mb-2">Password</label>
            <input type="password" name="password" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-red-500">
        </div>
        <div class="flex gap-3">
            <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">Create Admin</button>
            <button type="button" onclick="hideCreateForm()" class="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500">Cancel</button>
        </div>
    </form>
</div>

<!-- Admins List -->
<div class="bg-white rounded-lg shadow overflow-x-auto">
    <table class="w-full">
        <thead class="bg-gray-100 border-b-2 border-gray-300">
            <tr>
                <th class="px-6 py-3 text-left text-gray-700 font-bold">Username</th>
                <th class="px-6 py-3 text-left text-gray-700 font-bold">Email</th>
                <th class="px-6 py-3 text-left text-gray-700 font-bold">Role</th>
                <th class="px-6 py-3 text-left text-gray-700 font-bold">Created</th>
            </tr>
        </thead>
        <tbody>
            {% for admin in admins %}
            <tr class="border-b border-gray-200 hover:bg-gray-50">
                <td class="px-6 py-3 text-gray-800 font-medium">{{ admin.username }}</td>
                <td class="px-6 py-3 text-gray-600">{{ admin.email }}</td>
                <td class="px-6 py-3">
                    <span class="px-3 py-1 rounded-full text-sm font-bold {% if admin.role == 'admin' %}bg-blue-100 text-blue-800{% else %}bg-green-100 text-green-800{% endif %}">
                        {{ admin.role.capitalize() }}
                    </span>
                </td>
                <td class="px-6 py-3 text-gray-600 text-sm">{{ admin.created_at.strftime('%b %d, %Y') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function showCreateForm() {
    document.getElementById('createFormContainer').classList.remove('hidden');
}

function hideCreateForm() {
    document.getElementById('createFormContainer').classList.add('hidden');
}

document.getElementById('createAdminForm').addEventListener('submit', async e => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    
    try {
        const response = await fetch('{{ url_for("admin.create_admin") }}', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('Admin created successfully!');
            location.reload();
        } else {
            alert('Error: ' + data.error);
        }
    } catch (error) {
        alert('Error: ' + error);
    }
});
</script>
{% endblock %}
